<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org">
<head>
    <meta charset="UTF-8">
    <title>Patient Registration</title>
    
    <script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
</head>
<body>

<h2>Patient Registration Form</h2>

<!-- Success Message -->
<div th:if="${param.success}">
    <p style="color:green;">Patient registered successfully!</p>
</div>

<form th:action="@{/register}" th:object="${patient}" method="post">

    <label for="patientName">Patient Name:</label>
    <input type="text" th:field="*{patientName}" id="patientName" required />
    <br/>

    <label for="dob">Date of Birth:</label>
    <input type="date" th:field="*{dob}" id="dob" required />
    <br/>

    <label for="gender">Gender:</label>
    <select th:field="*{gender}" id="gender" required>
        <option value="" disabled selected>Select Gender</option>
        <option value="Male">Male</option>
        <option value="Female">Female</option>
        <option value="Other">Other</option>
    </select>
    <br/>

    <label for="relationType">Relation Type (S/O, D/O, etc.):</label>
    <input type="text" th:field="*{relationType}" id="relationType" />
    <br/>

    <label for="relationName">Relation Name:</label>
    <input type="text" th:field="*{relationName}" id="relationName" />
    <br/>

    <label for="stateSelect">State:</label>
    <select th:field="*{state}" id="stateSelect" required>
        <option value="" disabled selected>Select State</option>
        <option th:each="state : ${states}" th:value="${state.stateId}" th:text="${state.stateName}"></option>
    </select>
    <br/>

    <label for="citySelect">City:</label>
    <select th:field="*{city}" id="citySelect" required>
        <option value="" disabled selected>Select City</option>
        <!-- Options will be populated dynamically using JS -->
    </select>
    <br/>

    <button type="submit">Register</button>
</form>

<script type="text/javascript">
    $(document).ready(function () {
        $('#stateSelect').change(function () {
            const stateId = $(this).val();
            if (stateId) {
                $.ajax({
                    url: '/api/cities/' + stateId, // âœ… match your REST endpoint
                    type: 'GET',
                    success: function (cities) {
                        let citySelect = $('#citySelect');
                        citySelect.empty().append('<option value="" disabled selected>Select City</option>');
                        $.each(cities, function (index, city) {
                            citySelect.append(
                                $('<option>', {
                                    value: city.cityId,
                                    text: city.cityName
                                })
                            );
                        });
                    },
                    error: function () {
                        alert('Error fetching cities!');
                    }
                });
            } else {
                $('#citySelect').empty().append('<option value="" disabled selected>Select City</option>');
            }
        });
    });
</script>


</body>
</html>
